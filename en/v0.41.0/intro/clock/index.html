<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Clock - Spectator Docs</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/custom.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Clock";
    var mkdocs_page_input_path = "intro/clock.md";
    var mkdocs_page_url = "/intro/clock/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-82153845-2', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Spectator Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Getting Started</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../registry/">Registry</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Meter Types</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../counter/">Counters</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../timer/">Timers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../gauge/">Gauges</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dist-summary/">Distribution Summaries</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Clock</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#clock">Clock</a></li>
                
                    <li><a class="toctree-l4" href="#wall-time">Wall Time</a></li>
                
                    <li><a class="toctree-l4" href="#monotonic-time">Monotonic Time</a></li>
                
                    <li><a class="toctree-l4" href="#manual-clock">Manual Clock</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../conventions/">Naming Conventions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../testing/">Testing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../netflix/">Netflix Integration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../servo-comparison/">Servo Comparison</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Extensions</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-buffer-pools/">Buffer Pools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-gc/">Garbage Collection</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-gc-causes/">GC Causes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-memory-pools/">Memory Pools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/log4j2/">Log4j2 Appender</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/placeholders/">Placeholders</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Registries</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../registry/metrics3/">Metrics3</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../registry/servo/">Servo</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../reports/">Build Reports</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Spectator Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Getting Started &raquo;</li>
        
      
    
    <li>Clock</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/Netflix/spectator" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="clock">Clock<a class="headerlink" href="#clock" title="Permanent link">&para;</a></h1>
<p>When taking measurements or working with timers it is recommended to use the
<a href="http://netflix.github.io/spectator/en/latest/javadoc/spectator-api/com/netflix/spectator/api/Clock.html">clock</a>
interface. It provides two methods for measuring time:</p>
<h2 id="wall-time">Wall Time<a class="headerlink" href="#wall-time" title="Permanent link">&para;</a></h2>
<p>This is what most users think of for time. It can be used to get the current
time like what you would see on a wall clock. In most cases when not running
in tests this will call <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#currentTimeMillis--">System.currentTimeMillis()</a>.</p>
<p>Note that the values returned by this method may not be monontonically increasing.
Just like a clock on your wall, this value can go back in time or jump forward
at unpredictable intervals if someone sets the time. On many systems
<a href="https://en.wikipedia.org/wiki/Ntpd">ntpd</a> will be constantly keeping the time
synced up with an authoritative source.</p>
<p>With spectator, the clock is typically accessed via the <a href="../registry/">regstry</a>.
Example of usage:</p>
<pre><code class="java">// Current time in milliseconds since the epoch
long currentTime = registry.clock().wallTime();
</code></pre>

<h2 id="monotonic-time">Monotonic Time<a class="headerlink" href="#monotonic-time" title="Permanent link">&para;</a></h2>
<p>While it is good in general for the wall clock to show the correct time, the
unpredictable changes mean it is not a good choice for measuring how long an
operation took. Consider a simple example of measuring request latency on a
server:</p>
<pre><code class="java">long start = registry.clock().wallTime();
handleRequest(request, response);
long end = registry.clock().wallTime();
reqLatencyTimer.record(end - start, TimeUnit.MILLISECONDS);
</code></pre>

<p>If ntp fixes the server time between <code>start</code> and <code>end</code>, then the recorded
latency will be wrong. Spectator will protect against obviously wrong
measurements like negative latencies by dropping those values when they are
recorded. However, the change could incorrectly shorten or lengthen the
measured latency.</p>
<p>The clock interface also provides access to a monotonic source that is
only useful for measuring elapsed time, for example:</p>
<pre><code class="java">long start = registry.clock().monotonicTime();
handleRequest(request, response);
long end = registry.clock().monotonicTime();
reqLatencyTimer.record(end - start, TimeUnit.NANOSECONDS);
</code></pre>

<p>In most cases this will map to
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#nanoTime--">System.nanoTime()</a>.
Note the actual value returned is not meaningful unless compared with
another sample to get a delta.</p>
<h2 id="manual-clock">Manual Clock<a class="headerlink" href="#manual-clock" title="Permanent link">&para;</a></h2>
<p>If timing code is written to the clock interface, then alternative implemenations
can be plugged in. For test cases it is common to use
<a href="http://netflix.github.io/spectator/en/latest/javadoc/spectator-api/com/netflix/spectator/api/ManualClock.html">ManualClock</a>
so that tests can be reliable and fast without having to rely on hacks like sleep or
assuming something will run in less than a certain amount of time. </p>
<pre><code class="java">ManualClock clock = new ManualClock();
Registry registry = new DefaultRegistry(clock);

Timer timer = registry.timer(&quot;test&quot;);
timer.record(() -&gt; {
  doSomething();
  clock.setMonotonicTime(42L);
});

Assert.assertEquals(timer.totalTime(), 42L);
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../conventions/" class="btn btn-neutral float-right" title="Naming Conventions">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../dist-summary/" class="btn btn-neutral" title="Distribution Summaries"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Netflix/spectator" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../dist-summary/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../conventions/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
