<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Gauges - Spectator Docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/custom.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Gauges";
    var mkdocs_page_input_path = "intro/gauge.md";
    var mkdocs_page_url = "/intro/gauge/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-82153845-2', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Spectator Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Getting Started</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../registry/">Registry</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Meter Types</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../counter/">Counters</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../timer/">Timers</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Gauges</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#gauges">Gauges</a></li>
                
                    <li><a class="toctree-l4" href="#registration">Registration</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dist-summary/">Distribution Summaries</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../clock/">Clock</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../conventions/">Naming Conventions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../testing/">Testing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../netflix/">Netflix Integration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../servo-comparison/">Servo Comparison</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Extensions</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-buffer-pools/">Buffer Pools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-gc/">Garbage Collection</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-gc-causes/">GC Causes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/jvm-memory-pools/">Memory Pools</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/log4j2/">Log4j2 Appender</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ext/placeholders/">Placeholders</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Registries</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../registry/metrics3/">Metrics3</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../registry/servo/">Servo</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../reports/">Build Reports</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Spectator Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Getting Started &raquo;</li>
        
      
        
          <li>Meter Types &raquo;</li>
        
      
    
    <li>Gauges</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/Netflix/spectator/edit/master/docs/intro/gauge.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="gauges">Gauges<a class="headerlink" href="#gauges" title="Permanent link">&para;</a></h1>
<p>A gauge is a handle to get the current value. Typical examples for gauges
would be the size of a queue or number of threads in the running state.
Since gauges are sampled, there is no information about what might have
occurred between samples.</p>
<p>Consider monitoring the behavior of a queue of tasks. If the data is being
collected once a minute, then a gauge for the size will show the size when
it was sampled. The size may have been much higher or lower at some point
during interval, but that is not known.</p>
<h2 id="registration">Registration<a class="headerlink" href="#registration" title="Permanent link">&para;</a></h2>
<p>A gauge is registered by passing in an id, a reference to the object, and
a function to get or compute a numeric value based on the object. Note that
a gauge should only be registered once, not on each update. Consider this
example of a web server tracking the number of connections:</p>
<pre><code class="java">class HttpServer {
  // Tracks the number of current connections to the server
  private AtomicInteger numConnections;

  public HttpServer(Registry registry) {
    numConnections = registry.gauge(&quot;server.numConnections&quot;, new AtomicInteger(0));
  }

  public void onConnectionCreated() {
    numConnections.incrementAndGet();
    ...
  }

  public void onConnectionClosed() {
    numConnections.decrementAndGet();
    ...
  }

  ...
}
</code></pre>

<p>Gauges are <a href="../registry/#passive">passive</a>, i.e., they are not directly updated
when some activity occurs. The provide a way to register a function that allows
the registry to retrieve the current value when it is needed.</p>
<p>The reference to the object is passed in separately and the spectator registry
will keep a weak reference to the object. If the object is garbage collected,
then it will automatically drop the registration. In the example above, the registry
will have a weak reference to <code>numConnections</code> and the server instance will
have a strong reference to <code>numConnections</code>. If the server instance goes away,
then the gauge will as well.</p>
<p>When multiple gauges are registered with the same id the reported value will
be the sum of the matches. For example, if multiple instances of the <code>HttpServer</code>
class were created on different ports, then the value <code>server.numConnections</code>
would be the total number of connections across all server instances. If a different
behavior is desired, then ensure your usage does not perform multiple registrations.</p>
<p>There are several different ways to register a gauge:</p>
<h3 id="using-number">Using Number<a class="headerlink" href="#using-number" title="Permanent link">&para;</a></h3>
<p>A gauge can also be created based on an implementation of Number. Note the number
implementation should be thread safe. For example:</p>
<pre><code class="java">AtomicInteger size = new AtomicInteger();
registry.gauge(&quot;queue.size&quot;, size);
</code></pre>

<p>The call will return the Number so the registration can be inline on the
assignment:</p>
<pre><code class="java">AtomicInteger size = registry.gauge(&quot;queue.size&quot;, new AtomicInteger());
</code></pre>

<p>Updates to the value are preformed by updating the number instance directly.</p>
<h3 id="using-lambda">Using Lambda<a class="headerlink" href="#using-lambda" title="Permanent link">&para;</a></h3>
<p>Specify a lambda that takes the object as parameter.</p>
<pre><code class="java">public class Queue {

  @Inject
  public Queue(Registry registry) {
    registry.gauge(&quot;queue.size&quot;, this, Queue::size);
  }

  ...
}
</code></pre>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful to avoid creating a reference to the object in the
lambda. It will prevent garbage collection and can lead to a memory leak
in the application. For example, by calling size without using the passed
in object there will be a reference to <code>this</code>:</p>
<p><code>registry.gauge("queue.size", this, obj -&gt; size());</code></p>
</div>
<h3 id="using-reflection">Using Reflection<a class="headerlink" href="#using-reflection" title="Permanent link">&para;</a></h3>
<p>Use reflection to call a method on an object. The method must have an empty
parameter list and return a number. This approach can be used to access
methods that are not public.</p>
<pre><code class="java">public class Queue {

  @Inject
  public Queue(Registry registry) {
    registry.methodValue(&quot;queue.size&quot;, this, &quot;size&quot;);
  }

  ...
}
</code></pre>

<h3 id="collection-sizes">Collection Sizes<a class="headerlink" href="#collection-sizes" title="Permanent link">&para;</a></h3>
<p>For classes that implement <code>Collection</code> or <code>Map</code> there are helpers:</p>
<pre><code class="java">Queue queue = new LinkedBlockingQueue();
registry.collectionSize(&quot;queue.size&quot;, queue);

Map&lt;String, String&gt; cache = new ConcurrentMap&lt;&gt;();
registry.mapSize(&quot;cache.size&quot;, cache);
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../dist-summary/" class="btn btn-neutral float-right" title="Distribution Summaries">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../timer/" class="btn btn-neutral" title="Timers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/Netflix/spectator" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../timer/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../dist-summary/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
